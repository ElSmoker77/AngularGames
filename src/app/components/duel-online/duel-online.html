<!-- Si NO estoy en juego, muestro el lobby -->
<ng-container *ngIf="!(inGame$ | async); else gameTpl">
  <div class="duel-wrapper">
    <h1>Duelo online</h1>

    <div class="lobby-card">
      <label class="field">
        Tu nombre:
        <input
          [(ngModel)]="playerName"
          (input)="clearServerError()"
          placeholder="Ej: Maty" />
      </label>

      <!-- Selección de modo -->
      <div class="lobby-mode-select">
  <h3>Modo de juego</h3>
  <select [(ngModel)]="selectedMode">
    <option value="normal">Normal (sin probabilidades)</option>
    <option value="tactico">Táctico (con críticos y castigos)</option>
    <option value="cinematic">Cinematográfico (eventos raros + narrativa)</option>
    <option value="custom">Personalizado</option>
  </select>
</div>

      <!-- Configuración para modo personalizado -->
      <div class="custom-config" *ngIf="selectedMode === 'custom'">
        <h3>Configurar modo personalizado</h3>

        <div class="field">
          <label>
            Vidas por jugador (1–{{ maxLives }}):
            <input
              type="number"
              [(ngModel)]="customLives"
              [min]="1"
              [max]="maxLives" />
          </label>
        </div>

        <div class="field">
          <label>
            Balas máximas en el cargador (1–{{ maxAmmo }}):
            <input
              type="number"
              [(ngModel)]="customAmmo"
              [min]="1"
              [max]="maxAmmo" />
          </label>
        </div>

        <div class="field">
          <label>
            Probabilidad de disparo preciso (0–50%):
            <input
              type="number"
              [(ngModel)]="customPreciseShotChance"
              min="0"
              max="0.5"
              step="0.01" />
            <small>Ej: 0.1 = 10%</small>
          </label>
        </div>

        <div class="field">
          <label>
            Turnos sin atacar antes de perder una bala (0 = desactivado):
            <input
              type="number"
              [(ngModel)]="customTurtleTurns"
              min="0"
              max="10" />
          </label>
        </div>

        <div class="field">
          <label>
            Turnos AFK antes de quedar expuesto (1–10):
            <input
              type="number"
              [(ngModel)]="customAfkLimit"
              min="1"
              max="10" />
          </label>
        </div>
      </div>

      <div class="lobby-actions">
        <!-- Crear sala -->
        <div class="lobby-section">
          <h3>Crear sala</h3>
          <button (click)="createRoom()">Crear</button>

          <p *ngIf="(createdRoomId$ | async) as createdId">
            Código de sala: <strong>{{ createdId }}</strong><br />
            Compartilo con tu amigo para que se una.
          </p>
        </div>

        <!-- Unirse a sala -->
        <div class="lobby-section">
          <h3>Unirse a sala</h3>
          <input
            [(ngModel)]="roomCode"
            (input)="clearServerError()"
            placeholder="Código (6 caracteres)" />
          <button (click)="joinRoom()">Unirse</button>
        </div>
      </div>

      <p class="error" *ngIf="uiError">{{ uiError }}</p>
      <p class="error" *ngIf="(error$ | async) as srvErr">{{ srvErr }}</p>
    </div>
  </div>
</ng-container>

 <!-- Si estoy en juego, muestro el tablero -->
<ng-template #gameTpl>
  <div class="duel-wrapper game-wrapper">
    <div class="top-info">
      <div class="top-left">
        <div class="room-line" *ngIf="(roomId$ | async) as rid">
          <span class="room-label">Código de sala</span>
          <span class="room-code">{{ rid }}</span>
        </div>

        <div class="player-line" *ngIf="(playerId$ | async) as pid">
          <span class="player-label">Jugador</span>
          <span class="player-id">{{ pid }}</span>
        </div>
      </div>

      <button type="button" class="leave-btn" (click)="leaveGame()">
        ✕ Cerrar sala
      </button>
    </div>

    <app-duel-game
      *ngIf="(playerId$ | async) as pid"
      [playerId]="pid">
    </app-duel-game>

    <p class="error" *ngIf="(error$ | async) as srvErr">{{ srvErr }}</p>
  </div>
</ng-template>
